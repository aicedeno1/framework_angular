<div class="container">
  <h1>Buscador de Artículos Científicos - PLOS</h1>


  <div class="search-section">
    <div class="search-box">
      <input 
        type="text" 
        class="search-input" 
        [(ngModel)]="searchQuery"
        (keyup.enter)="search()"
        placeholder="Ingresa un término de búsqueda (ej: cancer, climate change, covid...)"
        [disabled]="loading">
      <button 
        class="btn btn-primary" 
        (click)="search()"
        [disabled]="loading || !searchQuery.trim()">
        {{ loading ? 'Buscando...' : 'Buscar' }}
      </button>
    </div>
  </div>


  <div class="error" *ngIf="error && !loading">
    {{ error }}
  </div>


  <div class="loading" *ngIf="loading">
    Buscando artículos...
  </div>

  <div *ngIf="!loading && articles.length > 0">

    <div class="results-info">
      Se encontraron <strong>{{ totalResults }}</strong> artículos. 
      Mostrando página <strong>{{ currentPage }}</strong> de <strong>{{ totalPages }}</strong>
    </div>

    <div class="export-buttons">
      <button class="btn btn-secondary" (click)="exportToCSV()">
        Exportar a CSV
      </button>
      <button class="btn btn-danger" (click)="exportToPDF()">
        Exportar a PDF
      </button>
    </div>

    <div class="page-size-selector">
      <label for="pageSize">Artículos por página:</label>
      <select 
        id="pageSize" 
        [(ngModel)]="pageSize" 
        (change)="onPageSizeChange()">
        <option *ngFor="let size of pageSizeOptions" [value]="size">
          {{ size }}
        </option>
      </select>
    </div>

    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Título</th>
            <th>Journal</th>
            <th>Fecha</th>
            <th>DOI</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let article of articles; let i = index">
            <td>{{ getArticleNumber(i) }}</td>
            <td>{{ article.title }}</td>
            <td>{{ article.journal }}</td>
            <td>{{ article.publication_date }}</td>
            <td>
              <a 
                [href]="getDOIUrl(article.doi)" 
                target="_blank" 
                class="doi-link"
                rel="noopener noreferrer">
                {{ article.doi }}
              </a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="pagination">
      <button 
        class="btn btn-primary btn-page" 
        (click)="previousPage()"
        [disabled]="currentPage === 1 || loading">
        ← Anterior
      </button>

      <button 
        *ngIf="shouldShowFirstPage()"
        class="btn btn-page"
        [class.active]="currentPage === 1"
        (click)="goToPage(1)"
        [disabled]="loading">
        1
      </button>

      <span *ngIf="shouldShowFirstPage()" class="page-dots">...</span>

      <button 
        *ngFor="let page of getPageNumbers()"
        class="btn btn-page"
        [class.active]="currentPage === page"
        (click)="goToPage(page)"
        [disabled]="loading">
        {{ page }}
      </button>

      <span *ngIf="shouldShowLastPage()" class="page-dots">...</span>

      <button 
        *ngIf="shouldShowLastPage()"
        class="btn btn-page"
        [class.active]="currentPage === totalPages"
        (click)="goToPage(totalPages)"
        [disabled]="loading">
        {{ totalPages }}
      </button>
      
      <button 
        class="btn btn-primary btn-page" 
        (click)="nextPage()"
        [disabled]="currentPage === totalPages || loading">
        Siguiente →
      </button>
    </div>
  </div>

  <div class="no-results" *ngIf="!loading && articles.length === 0 && searchQuery && !error">
    No se encontraron artículos
  </div>
</div>
